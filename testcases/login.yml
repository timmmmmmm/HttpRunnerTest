config:
    name: "Login"
    variables:
        twoFAToken: "check"
        secret: ${ENV(secret)}
    base_url: ${ENV(base_url)}

teststeps:
-   name: Login with user name
    variables:
        userName: TimmyHong
        password: 02ee0be1761db38a2ab3cb3adab0d4886def79f00fab7ff2c4ec115c26cd3b71
        deviceFingerprint: _vmhjlh1667276599542
    request:
        headers:
            content-type: application/json
            Accept: application/json
        params:
            password: $password
            captchaId: false
            captchaNumber: ''
            deviceFingerprint: $deviceFingerprint
            loginName: $userName
            keepLogin: false
        method: POST
        url: /api/login/
    validate:
        - eq: ["status_code", 200]
        - eq: ["body.code", 1]
    extract:
        twoFAToken: body.data.token

-   name: 2FA check
    request:
        headers:
            content-type: application/json
            Accept: application/json
        params:
            token: $twoFAToken
            otpCode: ${add_2FA_code($secret)}
        method: POST
        url: /api/user/check/2FA
    validate:
        -   eq: ["status_code", 200]
